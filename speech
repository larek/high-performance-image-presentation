Speech

Slide 1
Здравствуйте, меня зовут Александр Тихонов. Я расскажу про высокопроизводительные изображения. Поговорим о кодировании, о декодировании, конвертировании и о работе браузера с картинками. Что мы можем написать на JS для работы с нашими картинками.

Slide 2
Не для кого не секрет, что картинки создают большой траффик и являются самым большим и долгим загружаемым ресурсом на сайте. Есть такой сайт http://httparchive.org/, который спонсируется довольно известными компаниями Google, Mazilla, O'Rielly Media. Сайт сохраняет информацию о загружаемых ресурсах, картиночках, js скриптах и хранит историю. Это большая база для анализа трендов изменения размеров страниц, количества запросов и технологий.

Проблема в том, что картинки и так занимают много места и создают большой траффик, так они еще и увеличиваются по размеру и вес страницы становится гораздо больше из года в год

Изображения - один из лучших способов общения. Поэтому понятно, что вы можете чувствовать себя обманутым, когда вы берете книгу, наполненную словами, обсуждающими образы. Будьте уверены, вас не подведут. Изображения повсюду в Интернете - от пользовательского контента до рекламы продукта до журналистики для обеспечения безопасности. Создание, дизайн, компоновка, обработка и доставка изображений больше не являются эксклюзивным доменом творческих коллективов. Изображения в Интернете - это забота каждого.

Независимо от вашей роли, если вы несете ответственность за любую часть жизненного цикла изображений, эта книга будет полезна для вас.

У меня есть коллега, который работает фронденд-разработчиком и очень старается сделать фронтенд более производительным. И я всегда говорю, что смысл делать бандл меньшего размера, конкотенировать и минифицировать свой бандл, чтобы сделать его меньше на 100кб, если просто одна лишняя картинка может добавиться на странице и общий размер загружаемых ресурсов увеличтся на эти 100kb, а если еще картинки не обладают высокой производительностью, то приложение будет медленным.

Надо рассказать, что картинки больше вего по объему, грузятся дольше всех и создают большой траффик.


Slide 3
Основные форматы изображений

Далее надо перечилсть основные форматы изображений и сказать вкратце для чего какой нужен и остановиться на JPEG, потому что он самый популярный


Slide 4 
Подробнее о JPEG
Jpeg 2000? Jpeg XR?
Рассказать про JPEG, какие бывают jpeg и как они кодируют в YCbCr, про метаданые и про цветовую субдискретизацию, про baseline и progressive jpeg, показать практический пример, где мы разрезаем две картинки и прогрессивная картинка при 15% загрузки уже прорисовалась, но в плохом качестве. Рассказать про конвертеры imagemagick, gm, mozjpeg, quetzli, (imagemin?) показать identify -verbose и как мы можем проверить у нас правильная картинка или неправильная.

Slide 5 
Baseline and Progressive
Можно дать ссылочку и сказать, что cloudinary написали прикольную статью, где говориться, что есть что-то среднее между jpeg  baseline b jpeg прогрессив. И они описывают как это можно сделать. Сказать, что progressive дольше декодируются и показать как
Показать видео и свой пример с загрузкой части картинок. На основе этого примера, я придумал написать такой скрипт, благодаря которму можно указать в img data-percent 70% и он загрузит только 70 процентов картинки. Правда сделает больше запросов к серверу: потому что надо сначала узнать размер этой картинки.
Эта идея получения разыных по размеру картинок приша из формата FLIF (это надо проверить)

Рассказать про декодирование изображения в браузере. Показать в dev tools, рассказать, что изображение с 4:2:0 декодируется быстрее.

Как можно загружать картинки 
<img />
<picture />
<link rel='preloader' />

Рассказать про img.decode() показать пример с анимацией в браузере canary

Как лучше орагизовтаь lazyload c IntersectionObserve


libjpeg ? jpegtran ? jpegrescan?

про YCbCr прикольно вот тут https://cloudinary.com/blog/progressive_jpegs_and_green_martians
JPEG first converts RGB pixels to YCbCr pixels. Instead of having Red, Green and Blue channels, JPEG uses a luma (Y) channel and two chroma channels (Cb and Cr). Those channels are treated separately, because the human eye is more sensitive to distortion in luma (brightness) than it is to distortion in chroma (color). The chroma channels are optionally downsampled to half the original resolution; this is called chroma subsampling.

как установил mozjpeg 
поставил brew install jpeg-turbo ? не факт, что обязательно для mozjpeg, mozjpeg не ставится пока (https://github.com/imagemin/imagemin/issues/168)
короче, чтобы написать свой scan script надо че-то про jpegrescan или mozjpeg почитать

Надо описать проблему следующими словами
Я для начала объясню для чего я хочу углубиться в технические характеристики изображений. Давайте загрузим в браузер картинку и посмотрим в dev tools что происходит. Мы видим, что картиночка скачивается, и декодируется. Это можно посмотреть вот здесь и вот здесь. Так же для особо пытливых умов подскажу, что существует chrome://trace в котором вообще еще больше всякой отладочной информации. 


Рассказывая о прогрессивных JPEG и показывая свой пример по скачиванию части картинки, я расскажу о формате FLIF, потому что там была идея скачивания части картинки 
Рассказывая о FLIF надо сказать что есть полифилы и прочая хрень 
что можно настроить Imge Magick соответствующем образом для FLIF
https://uprootlabs.github.io/poly-flif/

Рассказывая о инструментах кодировки imagemagick и так далее надо показать как это пишется на js на соответствующих npm пакетах

Финал
Итак, перед нами очень большой инструментарий для того, чтобы повысить производительность изображений, уменьшить их размер и время загрузки, а следовательно и повысить производительность всего веб-приложения. 